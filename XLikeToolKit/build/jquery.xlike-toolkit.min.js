/*! xlike-toolkit 2014-01-23 */

var nodesArray=[],allJsonData=[];!function(a){function b(a,b){return b?(navigator.userAgent.toLowerCase().indexOf("msie")>-1?a.onreadystatechange=function(){("complete"===this.readyState||"loaded"===this.readyState)&&b()}:a.onload=function(){b()},void 0):!1}function c(a){var c;navigator.userAgent.toLowerCase().indexOf("msie")>-1?(c=document.createElement("script"),c.type="text/css_js"):(c=document.createElement("iframe"),c.style.display="none"),c.src=a+"?=a"+Math.random(),document.getElementsByTagName("body")[0].appendChild(c),b(c,function(){var b=document.createElement("link");b.href=a,b.type="text/css",b.rel="stylesheet",document.getElementsByTagName("head")[0].appendChild(b)})}function d(b){c("../../libs/entitygraph/css/jquery-ui.css"),c("../../libs/entitygraph/css/classify.css"),allJsonData.push(seg1);var d=f(),e="<div class='div4' id='map'></div>",g="<div id='options' class='form-horizontal'><div class='control-group' id='program'><label id='programlabel' class='control-label' for='username' style='float: left;'>layout:</label><div class='controls' id='programdiv'><select id='rule' style='width: 98%;'><option value='null'>--select--</option><option value='a'>default</option><option value='b'>tight</option><option value='c'>normal</option><option value='d'>simple</option></select></div></div><div class='control-group' id='program'><label class='control-label' for='username' id='programlabel' style='float: left;'>Relation Filter:</label><div class='controls' id='programdiv'><div id='slider2'></div></div></div></div>",h="#graph";a(h).html(e+g),a("#map").css("left","-2%").css("width","36%").css("border","1px dashed").css("display","inline-block").css("FILTER","alpha(opacity=0)").css("background-color","white").css("float","left"),a("#options").css("width","16%").css("float","left").css("padding-left","1em"),a("#programdiv").css("width","130px").css("margin-left","160px").css("margin-bottom","6px"),r(d,b.defrel,b.map.width,b.map.height)}function e(a,b){var c=!1;for(var d in a)if(a[d]===b){c=!0;break}return c}function f(){for(var a=[],b=[],c=0;c<allJsonData.length;c++){var d=n(allJsonData[c]),e=d.nodesArray,f=d.linksArray;a=a.concat(e),b=b.concat(f)}var h=g(a),j=i(b),k=new m(h,j),l=p(k),o=q(l),r=JSON.parse(o);return r}function g(a){var b=[];if(0!==a.length){b.push(a[0]);for(var c in a){var d=0;for(var e in b){if(a[c].id===b[e].id)break;d++}d===b.length&&(b[d]=a[c])}}return b}function h(a,b){var c=[];for(var d in a)if(a[d]===b){c=a.splice(d,1);break}return c}function i(a){var b=[];if(0!==a.length){b[0]=a[0];for(var c in a){var d=0;for(var e in b){if(a[c].source===b[e].source&&a[c].target===b[e].target||a[c].target===b[e].source&&a[c].source===b[e].target)break;d++}d===b.length&&(b[d]=a[c])}}return b}function j(a,b,c,d,e){this.name=a,this.type=b,this.id=c,this.uri=d,this.index=e}function k(a,b,c,d){this.name=a,this.type=b,this.id=c,this.uri=d}function l(a,b,c){this.source=a,this.target=b,this.value=c}function m(a,b){this.nodesArray=a,this.linksArray=b}function n(a){var b=[],c=[],d="loc",e=a.similarEvents,f=a.betweenEventSimilarity,g=a.eventInfo.id,h=d,i=a.eventInfo.primaryStory.medoidArticle.title,j=a.eventInfo.primaryStory.uri;c.push(new k(i,h,g,j));for(var n in e){var o=a.similarEvents[n].primaryStory.medoidArticle.title,p=d,q=a.similarEvents[n].id,r=a.similarEvents[n].primaryStory.uri;b.push(new l(g,q,e[n].sim)),c.push(new k(o,p,q,r))}for(var s in f){var t=f[s].id1,u=f[s].id2,v=f[s].sim;0!==v&&b.push(new l(t,u,v))}return new m(c,b)}function o(a,b){var c=0;for(var d in a)if(a[d].id===b){c=d;break}return c}function p(a){var b=a.nodesArray,c=a.linksArray,d=[],e=[];for(var f in b){var g=b[f].name,h=b[f].type,i=b[f].id,k=b[f].uri;d.push(new j(g,h,i,k,f))}for(var n in c){var p=c[n].source,q=c[n].target,r=c[n].value,s=o(b,p),t=o(b,q);e.push(new l(s,t,r))}return new m(d,e)}function q(a){var b=a.nodesArray,c=a.linksArray,d="";d+='{"nodes":[';for(var e=0;e<b.length;e++)0!==e&&(d+=","),d+='{"name":"',d+=b[e].name,d+='","type":"',d+=b[e].type,d+='"}';d+='],"links":[';for(var f=0;f<c.length;f++)0!==f&&(d+=","),d+='{"source":',d+=c[f].source,d+=',"target":',d+=c[f].target,d+=',"value":',d+=c[f].value,d+="}";return d+="]}"}function r(b,c,d,g){function i(){a("#rule").change(function(){"a"===a(this).val()?(s(0,0,4,10,1),a("#slider1").slider("value",1),a("#slider2").slider("value",0),a("#slider3").slider("value",4),a("#slider4").slider("value",100),a("#slider5").slider("value",10)):"b"===a(this).val()?(s(1,20,2,.1,.1),a("#slider1").slider("value",1),a("#slider2").slider("value",20),a("#slider3").slider("value",2),a("#slider4").slider("value",1),a("#slider5").slider("value",1)):"c"===a(this).val()?(s(3,50,3,13,7),a("#slider1").slider("value",3),a("#slider2").slider("value",30),a("#slider3").slider("value",3),a("#slider4").slider("value",130),a("#slider5").slider("value",70)):"d"===a(this).val()&&(s(6,0,3,10,3),a("#slider1").slider("value",6),a("#slider2").slider("value",50),a("#slider3").slider("value",3),a("#slider4").slider("value",100),a("#slider5").slider("value",30))}),a("#slider1").slider({range:"max",min:0,max:10,value:C,slide:function(a,b){x(b.value)}}),a("#slider2").slider({range:"max",min:0,max:100,value:G,slide:function(a,b){y(b.value/100)}}),a("#slider3").slider({min:0,max:10,value:F,slide:function(a,b){w(b.value)}}),a("#slider4").slider({min:1,max:100,value:10*E,slide:function(a,b){v(b.value/10)}}),a("#slider5").slider({min:1,max:30,value:10*D,slide:function(a,b){u(b.value/10)}})}function j(a){var b;if(a instanceof Array){b=[];for(var c=a.length;c--;)b[c]=j(a[c]);return b}if(a instanceof Object){b={};for(var d in a)b[d]=j(a[d]);return b}return a}function k(a){var c=d3.scale.linear();c.domain([0,5e-5,1e-4,.005,.1,.6,1]),c.range([0,.001,.3,.4,.5,.9,1]);for(var d in b.links)b.links[d].value=c(b.links[d].value);for(var e in b.nodes)b.nodes[e].id=e;P=j(b.nodes),R=j(b.links),Q=j(b.nodes),S=j(b.links),a&&l()}function l(){for(var b in R)$=$>o(R[b].value)?$:o(R[b].value);J=d3.layout.force().charge(-300).friction(.8).linkDistance(function(a){return o(a.value)/$*(T/2)}).linkStrength(.5).size([T,U]),J.nodes(P).links(R).start(),M=d3.select("#map").append("svg").attr("width",T).attr("height",U),L=M.selectAll("line.link").data(R).enter().append("line"),K=M.selectAll(".node").data(P).enter().append("g"),L.attr("class","link").attr("id",function(a){return"l"+a.id}),K.attr("id",function(a){return"loc"===a.type?"loc"+a.id:void 0}).attr("class","node").call(J.drag),N=K.append("rect"),O=K.append("text"),m(),n(),K.on("mouseover",function(a,b){document.getElementById("graph").setAttribute("title",nodesArray[b].name),d3.select(this).select("rect").style("fill").colorHex()===cb&&(d3.select(this).select("rect").style("fill",eb),d3.select(this).select("text").style("fill","#FFF")),L.style("stroke",function(b){return b.source===a?(d3.select("#n"+b.target.id+" rect").style("stroke",eb).style("fill-opacity","0.6").attr("rx",0).attr("ry",0),d3.select("#n"+b.target.id+" text").style("fill","black"),"red"):b.target===a?(d3.select("#n"+b.source.id+" rect").style("stroke",eb).style("fill-opacity","0.6").attr("rx",0).attr("ry",0),d3.select("#n"+b.source.id+" text").style("fill","black"),"red"):void 0})}),K.on("mouseout",function(){m(),d3.select(this).select("rect").style("fill").colorHex()!==fb&&(d3.select(this).select("rect").style("fill",cb),d3.select(this).select("text").style("fill",db))}),K.on("click",function(b){d3.select(this).select("rect").style("fill").colorHex()===eb?(e(t,b.name)||t.push(b.name),d3.select(this).select("rect").style("fill",fb),d3.select(this).select("text").style("fill","#FFF")):d3.select(this).select("rect").style("fill").colorHex()===fb&&(h(t,b.name),d3.select(this).select("rect").style("fill","#cccccc"),d3.select(this).select("text").style("fill",db)),a("#map").html(""),allJsonData.push(seg2);var c=f(allJsonData);r(c,G,688,450),d3.select(this).select("rect").style("fill")!==fb&&(d3.select(this).select("rect").style("fill",cb),d3.select(this).select("text").style("fill",db))}),P.forEach(function(a){a.visible=a.weight>C?1:0}),J.on("tick",function(){L.attr("x1",function(a){return p(a.source.x,1)}).attr("y1",function(a){return q(a.source.y,1)}).attr("x2",function(a){return p(a.target.x,1)}).attr("y2",function(a){return q(a.target.y,1)}),K.attr("transform",function(a){return"translate("+p(a.x,a.visible)+","+q(a.y,a.visible)+")"})})}function m(){L.style("stroke-width",function(a){return 6/o(a.value)}).style("stroke",function(){return""}).style("stroke-opacity",function(a){return a.source.weight>C&&a.target.weight>C?.3:0})}function n(){N.attr("x",function(a){return a.name.length>3?-(Y+(a.name.substring(0,8).length-3)*Z)/2.5:-Y/2.5}).attr("y",function(a){return"topic"===a.type?X/-2:X/2.5/-2}).attr("width",function(a){return a.name.length>3?(a.name.substring(0,10).length-3)*Z:Y}).attr("height",function(a){return"topic"===a.type?X:X/2.5}).attr("rx",function(a){return"topic"===a.type?Y/3:8}).attr("ry",function(a){return"topic"===a.type?X/2.5:8}).style("fill",function(a){var b=bb[a.type];for(var c in t)if(a.name===t[c]){b=fb;break}return b}).style("stroke",function(a){return bb[a.type]}).style("fill-opacity","0.9"),O.attr("dy",".3em").style("text-anchor","middle").style("fill",function(a){var b=db;for(var c in t)if(a.name===t[c]){b="#FFF";break}return b}).style("font","12px sans-serif").text(function(a){return a.name.length>10?a.name.substring(0,10)+"...":a.name})}function o(a){var b=_-D*ab(a)/ab(E);return b}function p(a,b){return 0===b?-100:(a=Y/2>a?Y-a:a,a=a>T-Y/2?2*T-a-Y:a)}function q(a,b){return 0===b?-100:(a=X/2>a?X-a/2:a,a=a>U-X/2?2*U-a-X:a)}function s(a,b,c,d,e){F=c,z(),D=e,E=d,A(),C=a,B(),G=b/100,B()}function u(a){D=a,A()}function v(a){E=a,A()}function w(a){F=a,z()}function x(a){C=a,B()}function y(a){G=a,B()}function z(){X=V*F,Y=W*F,n()}function A(){var a=0,b=0;for(var c in R)a=a>o(R[c].value)?a:o(R[c].value);B(),J.linkDistance(function(c){return b=b>o(c.value)/a*(T/2)?b:o(c.value)/a*(T/2),o(c.value)/a*(T/2)})}function B(){R.forEach(function(a,b){a.value<G?a.source!==H&&a.target!==H&&(a.source=I,a.target=I):a.source===I&&a.source!==H&&a.target!==H&&(R[b]=j(S[b]))}),J.nodes(P).links(R).start(),M.selectAll("line.link").data(R).enter(),m(),P.forEach(function(a){a.visible=a.weight>C?1:0}),J.on("tick",function(){L.attr("x1",function(a){return p(a.source.x,a.source.visible)}).attr("y1",function(a){return q(a.source.y,a.source.visible)}).attr("x2",function(a){return p(a.target.x,a.target.visible)}).attr("y2",function(a){return q(a.target.y,a.target.visible)}),K.attr("transform",function(a){return"translate("+p(a.x,a.visible)+","+q(a.y,a.visible)+")"})})}var C=1,D=1,E=10,F=4,G=c,H=JSON.parse('{"id":"n999999","name":"null","type":"null","x":-100,"y":-100}'),I=JSON.parse('{"id":"n888888","name":"null","type":"null","x":-100,"y":-100}');nodesArray=b.nodes,e(t,nodesArray[0].name)||t.push(nodesArray[0].name),i();var J,K,L,M,N,O,P,Q,R,S,T=d,U=g,V=9,W=14,X=V*F,Y=W*F,Z=12,$=0,_=5,ab=d3.scale.log(),bb=(d3.scale.category10(),[]);bb.loc="#cccccc",bb.LOC="#cccccc";var cb="#cccccc",db="#666666",eb="#ff4500",fb="#9933cc";k(!0)}var s={};a.fn.entitygraph=function(b){var c=a.extend({},s,b||{});return this.each(function(){a(this);d(c)})};var t=[]}(jQuery);var nodesArray=[];!function(a){function b(a,b){return b?(navigator.userAgent.toLowerCase().indexOf("msie")>-1?a.onreadystatechange=function(){("complete"===this.readyState||"loaded"===this.readyState)&&b()}:a.onload=function(){b()},void 0):!1}function c(a){var c;navigator.userAgent.toLowerCase().indexOf("msie")>-1?(c=document.createElement("script"),c.type="text/css_js"):(c=document.createElement("iframe"),c.style.display="none"),c.src=a+"?=a"+Math.random(),document.getElementsByTagName("body")[0].appendChild(c),b(c,function(){var b=document.createElement("link");b.href=a,b.type="text/css",b.rel="stylesheet",document.getElementsByTagName("head")[0].appendChild(b)})}function d(b){c("../../libs/graph/css/jquery-ui.css"),c("../../libs/graph/css/bootstrap.css");var d="<div class='div4' id='"+b.graph.container+"'></div>",f="<div id='"+b.settings.container+"' class='form-horizontal'><div class='control-group' id='program'><label id='programlabel' class='control-label' for='username'><Strong>"+b.settings.layout+":</Strong></label><div class='controls' id='programdiv'><select id='rule' style='width: 98%;'><option value='null'>--select--</option><option value='a'>default</option><option value='b'>tight</option><option value='c'>normal</option><option value='d'>simple</option></select></div></div><div class='control-group' id='program'><label class='control-label' for='username' id='programlabel'><Strong>"+b.settings.eflabel+":</Strong></label><div class='controls' id='programdiv'><div id='slider1'></div><div id='slider1Info'></div></div></div><div class='control-group' id='program'><label class='control-label' for='username' id='programlabel'><Strong>"+b.settings.rflabel+":</Strong></label><div class='controls' id='programdiv'><div id='slider2'></div><div id='slider2Info'></div></div></div><div class='control-group' id='program'><label class='control-label' for='username' id='programlabel'><Strong>"+b.settings.wslabel+":</Strong></label><div class='controls' id='programdiv'><div id='slider3'></div></div></div><div class='control-group' id='program'><label class='control-label' for='username' id='programlabel'><Strong>"+b.settings.lclabe+":</Strong></label><div class='controls' id='programdiv'><div id='topiclist' style='width: 300px'></div></div></div></div>",g=d+f,h="#"+b.container;a(h).html(g);var i="#"+b.settings.container;a(i).css("width",b.settings.sw).css("height",b.settings.sh).css("float","left").css("margin-left","1em");var j="#"+b.graph.container;a(j).css("margin-left","1%").css("width","50%").css("border","1px dashed").css("display","inline-block").css("FILTER","alpha(opacity=0)").css("background-color","white").css("float","left");var k="#"+b.container;a(k).css("width","90%").css("margin-top","1em");var l=e(b.graph.data),m=JSON.parse(l);A(m,b)}function e(a){function b(a,b,c,d){this.name=a,this.type=b,this.id=c,this.uri=d}function c(a,b,c){this.source=a,this.target=b,this.value=c}var d="",e=a.concepts,h=a.links;for(var i in e){var j=e[i].label,k=g(e[i].type),l=e[i].id,m=e[i].uri;nodesArray.push(new b(j,k,l,m))}var n=[];for(var o in h){var p=h[o].id1,q=h[o].id2,r=f(nodesArray,p),s=f(nodesArray,q),t=h[o].score;n.push(new c(r,s,t))}d+='{"nodes":[';for(var u=0;u<nodesArray.length;u++)0!==u&&(d+=","),d+='{"name":"',d+=nodesArray[u].name,d+='","type":"',d+=nodesArray[u].type,d+='"}';d+='],"links":[';for(var v=0;v<n.length;v++)0!==v&&(d+=","),d+='{"source":',d+=n[v].source,d+=',"target":',d+=n[v].target,d+=',"value":',d+=n[v].value,d+="}";return d+="]}"}function f(a,b){var c=0;for(var d in a)if(a[d].id-b===0){c=d;break}return c}function g(a){var b="";return-1!==a.search("org")?b="org":-1!==a.search("loc")?b="loc":-1!==a.search("per")&&(b="per"),b}function h(){var a=0,b={};this.put=function(c,d){this.containsKey(c)||a++,b[c]=d},this.get=function(a){return this.containsKey(a)?b[a]:null},this.remove=function(c){delete b[c]&&a--},this.containsKey=function(a){return a in b},this.containsValue=function(a){for(var c in b)if(b[c]===a)return!0;return!1},this.values=function(){var c=new Array(a);for(var d in b)c.push(b[d]);return c},this.keys=function(){var c=new Array(a);for(var d in b)c.push(d);return c},this.size=function(){return a}}function i(a){O=a/4,u()}function j(a){P=a,n()}function k(a){S=a,u()}function l(){G.attr("x",function(a){return a.name.length>3?-(bb+(a.name.substring(0,8).length-3)*cb)/2:-bb/2}).attr("y",function(){return ab/2.5/-2}).attr("width",function(a){var b=0;return b=a.name.length<=3?3*bb:a.name.length>3&&a.name.length<9?bb+a.name.substring(0,8).length*cb:bb+(a.name.substring(0,8).length-3)*cb}).attr("height",function(){return ab/2.5}).attr("rx",function(){return 8}).attr("ry",function(){return 8}).style("fill",function(a){return gb[a.type]}).style("stroke",function(a){return gb[a.type]}).style("fill-opacity","0.9"),H.attr("dy",".3em").attr("dx",function(a){return a.name.length>4?"null":"1.3em"}).style("text-anchor","middle").style("fill",function(){return"#666"}).style("font","12px arial").text(function(a){return a.name.length>8?a.name.substring(0,8)+"...":a.name})}function m(){ab=Z*R,bb=$*R,l()}function n(){var a=0,b=0;for(var c in K)a=a>q(K[c].value)?a:q(K[c].value);u(),C.linkDistance(function(c){return b=b>q(c.value)/a*(X/2)?b:q(c.value)/a*(X/2),q(c.value)/a*(X/2)})}function o(a,b,c,d,e){R=c,m(),P=e,Q=d,n(),O=a,u(),S=b,u()}function p(){a("#rule").change(function(){"a"===a(this).val()?(o(0,0,4,10,1),a("#slider1").slider("value",1),a("#slider2").slider("value",U),a("#slider3").slider("value",1)):"b"===a(this).val()?(o(1,0,2,.1,2),a("#slider1").slider("value",1),a("#slider2").slider("value",T/12),a("#slider3").slider("value",2)):"c"===a(this).val()?(o(1,0,3,10,1),a("#slider1").slider("value",1),a("#slider2").slider("value",T/10),a("#slider3").slider("value",1)):"d"===a(this).val()&&(o(2,120,3,10,1),a("#slider1").slider("value",6),a("#slider2").slider("value",T/9),a("#slider3").slider("value",20))}),a("#slider1").slider({range:"max",min:0,max:10,value:O,slide:function(a,b){i(b.value)}}),a("#slider1Info").val("weights: >"+a("#slider1").slider("value")),a("#slider2").slider({range:"max",max:T/3,min:U,value:S,slide:function(a,b){k(b.value)}}),a("#slider2Info").val("relation: >"+a("#slider2").slider("value")),a("#slider3").slider({range:"max",min:0,max:4,value:P,slide:function(a,b){j(b.value)}}),a("#slider3Info").val("weight setting: >"+a("#slider3").slider("value"))}function q(a){var b=eb-P*fb(a)/fb(Q);return b}function r(a,b){return 0===b?-100:(a=bb/2>a?bb-a:a,a=a>X-bb/2?2*X-a-bb:a)}function s(a,b){return 0===b?-100:(a=ab/2>a?ab-a/2:a,a=a>Y-ab/2?2*Y-a-ab:a)}function t(){E.style("stroke-width",function(a){return 5/q(a.value)}).style("stroke",function(){return""}).style("stroke-opacity",function(a){return a.source.weight>O&&a.target.weight>O?.9:0})}function u(){K.forEach(function(a,b){a.value<S?a.source!==V&&a.target!==V&&(a.source=W,a.target=W):a.source===W&&a.source!==V&&a.target!==V&&(K[b]=z(L[b]))});a("#topiclist :checkbox");C.nodes(I).links(K).start(),F.selectAll("line.link").data(K).enter(),t(),I.forEach(function(a){a.visible=a.weight>O?1:0}),C.on("tick",function(){E.attr("x1",function(a){return r(a.source.x,a.source.visible)}).attr("y1",function(a){return s(a.source.y,a.source.visible)}).attr("x2",function(a){return r(a.target.x,a.target.visible)}).attr("y2",function(a){return s(a.target.y,a.target.visible)}),D.attr("transform",function(a){return"translate("+r(a.x,a.visible)+","+s(a.y,a.visible)+")"})})}function v(){a("#topiclist :checkbox");a("#topiclist :checkbox").click(function(){var b=this.checked,c=a(this).attr("id");b?w(c):x(c),u()})}function w(a){hb.containsKey(a)||hb.put(a,a),L=z(N),J=z(M),L.forEach(function(b,c){J[b.source].type===a&&J[b.target].type===a?K[c]=z(L[c]):J[b.source].type===a&&J[b.target].type!==a?(hb.containsKey(J[b.target].type)||(L[c].target=L[c].source),K[c]=z(L[c])):J[b.source].type!==a&&J[b.target].type===a?(hb.containsKey(J[b.source].type)||(L[c].source=L[c].target),K[c]=z(L[c])):hb.containsKey(J[b.source].type)&&hb.containsKey(J[b.target].type)?K[c]=z(L[c]):hb.containsKey(J[b.source].type)&&!hb.containsKey(J[b.target].type)?(L[c].target=L[c].source,K[c]=z(L[c])):!hb.containsKey(J[b.source].type)&&hb.containsKey(J[b.target].type)&&(L[c].source=L[c].target,K[c]=z(L[c]))})}function x(a){hb.containsKey(a)&&hb.remove(a),K.forEach(function(a){hb.containsKey(a.source.type)?hb.containsKey(a.target.type)?(a.source=a.source,a.target=a.target):a.target=a.source:hb.containsKey(a.target.type)?a.source=a.target:(a.source=V,a.target=V)})}function y(b,c,d){hb.containsKey(c)||hb.put(c,c),a("#topiclist").append('<div id="topiclist'+c+'" style="margin-bottom: 6px;"><input type="checkbox" id="'+c+'" clase="topicset" checked="true" /><input type="button" style="background: '+d+';width: 60px; border: 0px;margin-left: 5px;"><span style="vertical-align: middle;margin-left: 5px;">'+b+"</span></div>")}function z(a){var b;if(a instanceof Array){b=[];for(var c=a.length;c--;)b[c]=z(a[c]);return b}if(a instanceof Object){b={};for(var d in a)b[d]=z(a[d]);return b}return a}function A(b,c){function d(a){var b=d3.scale.linear();b.domain([0,5e-5,1e-4,.005,.1,.6,1]),b.range([0,.001,.3,.4,.5,.9,1]);for(var c in h)h[c].value=b(h[c].value);for(var d in g)g[d].id=d;I=z(g),K=z(h),J=z(g),L=z(h),a&&e()}function e(){for(var b in K)db=db>q(K[b].value)?db:q(K[b].value);C=d3.layout.force().charge(-300).friction(.9).linkDistance(function(a){return q(a.value)/db*(X/3)}).linkStrength(.5).size([X,Y]),C.nodes(I).links(K).start();var d="#"+c.graph.container;F=d3.select(d).append("svg").attr("width",X).attr("height",Y),E=F.selectAll("line.link").data(K).enter().append("line"),D=F.selectAll(".node").data(I).enter().append("g"),y("person","per",gb.per),y("localtion","loc",gb.loc),y("organization","org",gb.org),v(),E.attr("class","link").attr("id",function(a){return"l-"+a.source.type+":"+a.source.id+"-"+a.target.type+":"+a.target.id}),D.attr("id",function(a){return"loc"===a.type?"loc"+a.id:"per"===a.type?"per"+a.id:"org"===a.type?"org"+a.id:void 0}).attr("class","node").call(C.drag),G=D.append("rect"),H=D.append("text"),t(),l();var e="#"+c.container;D.on("mouseover",function(b,c){a(e).attr("title",nodesArray[c].uri),d3.select(this).select("rect").style("fill","#FF99CC"),d3.select(this).select("text").style("fill","#000000"),E.style("stroke",function(a){return a.source===b?(d3.select("#n"+a.target.id+" rect").style("stroke","orangered").style("fill-opacity","0.6").attr("rx",0).attr("ry",0),d3.select("#n"+a.target.id+" text").style("fill","black"),"red"):a.target===b?(d3.select("#n"+a.source.id+" rect").style("stroke","orangered").style("fill-opacity","0.6").attr("rx",0).attr("ry",0),d3.select("#n"+a.source.id+" text").style("fill","black"),"red"):void 0})}),D.on("mouseout",function(){t(),l()}),C.on("tick",function(){E.attr("x1",function(a){return r(a.source.x,1)}).attr("y1",function(a){return s(a.source.y,1)}).attr("x2",function(a){return r(a.target.x,1)}).attr("y2",function(a){return s(a.target.y,1)}),D.attr("transform",function(a){return"translate("+r(a.x,a.visible)+","+s(a.y,a.visible)+")"})})}if(X=c.graph.gw,Y=c.graph.gh,"undefined"==typeof c.color){var f=d3.scale.category20();gb.loc=f(0),gb.org=f(1),gb.per=f(2),gb.topic=f(3)}else gb.topic=c.color[0],gb.loc=c.color[1],gb.org=c.color[2],gb.per=c.color[3];var g=b.nodes,h=b.links;M=z(g),N=z(h),T=_.max(_.pluck(b.links,"value")),U=_.min(_.pluck(b.links,"value")),p(),d(!0)}var B={};a.fn.graph=function(b){var c=a.extend({},B,b||{});return this.each(function(){a(this);d(c)})};var C,D,E,F,G,H,I,J,K,L,M,N,O=0,P=1,Q=10,R=3,S=0,T=100,U=0,V=JSON.parse('{"id":"n999999","name":"null","type":"null","x":null,"y":null}'),W=JSON.parse('{"id":"n888888","name":"null","type":"null","x":null,"y":null}'),X=0,Y=0,Z=9,$=5,ab=Z*R,bb=$*R,cb=12,db=0,eb=5,fb=d3.scale.log(),gb=(d3.scale.category10(),[]),hb=new h}(jQuery),function(a){function b(a){var b=a.container;-1===a.container.indexOf("#")&&(b="#"+b),RadarChart.draw(b,a.data,a.config);var c=d3.select(b).selectAll("svg").append("svg").attr("width",a.config.w+300).attr("height",a.config.h),d=(c.append("text").attr("class","title").attr("transform","translate("+a.title.left+","+a.title.top+")").attr("x",a.config.w-70).attr("y",10).attr("font-size",a.title.fontsize).attr("fill",a.title.color).text(a.title.title),c.append("g").attr("class","legend").attr("height",100).attr("width",200).attr("transform","translate("+a.legend.left+","+a.legend.top+")"));d.selectAll("rect").data(a.legend.LegendOptions).enter().append("rect").attr("x",a.config.w-65).attr("y",function(a,b){return 20*b}).attr("width",10).attr("height",10).style("fill",function(b,c){return a.legend.colorscale(c)}),d.selectAll("text").data(a.legend.LegendOptions).enter().append("text").attr("x",a.config.w-52).attr("y",function(a,b){return 20*b+9}).attr("font-size",a.legend.fontsize).attr("fill",a.legend.color).text(function(a){return a})}var c={};a.fn.radar=function(d){var e=a.extend({},c,d||{});return this.each(function(){a(this);b(e)})}}(jQuery),function(a){function b(a){var b=[],c=a.color,d=a.color[0],e=d3.time.format("%m/%d/%y"),f=a.margin,g=a.width,h=a.height,i=0,j=d3.select("body").append("div").attr("class","remove").style("position","absolute").style("z-index","20").style("visibility","hidden").style("top","30px").style("left","55px"),k=d3.time.scale().range([0,g]),l=d3.scale.linear().range([h-10,0]),m=d3.scale.ordinal().range(c),n=d3.layout.stack().offset("silhouette").values(function(a){return a.values}).x(function(a){return a.date}).y(function(a){return a.value}),o=d3.nest().key(function(a){return a.key}),p=d3.svg.area().interpolate("cardinal").x(function(a){return k(a.date)}).y0(function(a){return l(a.y0)}).y1(function(a){return l(a.y0+a.y)}),q="."+a.container,r=d3.select(q).append("svg").attr("width",g+f.left+f.right).attr("height",h+f.top+f.bottom).append("g").attr("transform","translate("+f.left+","+f.top+")"),s=a.data,t=(s.forEach(function(a){a.date=e.parse(a.date),a.keyword=a.value.split(":")[0],a.entity=a.value.split(":")[1],a.value=+a.value.split(":")[2]}),n(o.entries(s)));i=(_.max(_.pluck(t[0].values,"date"))-_.min(_.pluck(t[0].values,"date")))/1e3/60/60/24;var u=d3.svg.axis().scale(k).orient("bottom").tickFormat(d3.time.format("%Y-%m-%d")).tickSize(5).tickPadding(8);4>=i/7?u.ticks(d3.time.days):i/7>4&&28>=i/7?u.ticks(d3.time.weeks):i/28>4&&28>=i/28?u.ticks(d3.time.months):i/196>4&&28>=i/196&&u.ticks(d3.time.years);{var v=d3.svg.axis().scale(l);d3.svg.axis().scale(l)}k.domain(d3.extent(s,function(a){return a.date})),l.domain([0,d3.max(s,function(a){return a.y0+a.y})]),r.selectAll(".layer").data(t).enter().append("path").attr("class","layer").attr("d",function(a){return p(a.values)}).style("fill",function(a,b){return m(b)}),r.append("g").attr("class","x axis").attr("transform","translate(0,"+h+")").call(u),r.selectAll("g").select("text").attr("transform","rotate(-25)").attr("x","-25"),r.append("g").attr("class","y axis").attr("transform","translate("+g+", 0)").call(v.orient("right")),r.append("g").attr("class","y axis").call(v.orient("left")),r.selectAll(".layer").attr("opacity",1).on("mouseover",function(a,b){r.selectAll(".layer").transition().duration(450).attr("opacity",function(a,c){return c!==b?.6:1})}).on("mousemove",function(a){mousex=d3.mouse(this),mousex=mousex[0];var c=k.invert(mousex),e=c.getFullYear(),f=c.getMonth()+1,g=c.getDate();10>f&&(f="0"+f),10>g&&(g="0"+g);var h=e+"-"+f+"-"+g;c=c.getMonth()+c.getDate();for(var i=a.values,l=0;l<i.length;l++)b[l]=i[l].date,b[l]=b[l].getMonth()+b[l].getDate();mousedate=b.indexOf(c),pro=a.values[mousedate].value,keyword=a.values[mousedate].keyword,entity=a.values[mousedate].entity,d3.select(this).classed("hover",!0).attr("stroke",d).attr("stroke-width","0.5px"),j.html("<p><Strong><Span style='font-size:14px;'>Topic : </span></Strong>"+a.key+"<br><Strong><Span style='font-size:14px;'>CurDate :</span> </Strong>"+h+"<br><Strong><Span style='font-size:14px;'>Keyword :</span> </Strong>"+keyword+"<br><Strong><Span style='font-size:14px;'>Entity : </span></Strong>"+entity+"<br><Strong><Span style='font-size:14px;'>Similarity : </span></Strong>"+pro+"</p>").style("visibility","visible")}).on("mouseout",function(){});var w=d3.select(q).append("div").attr("class","remove").style("position","absolute").style("z-index","19").style("width","1px").style("height","380px").style("top","10px").style("bottom","30px").style("left","0px").style("background","#fff");d3.select(q).on("mousemove",function(){mousex=d3.mouse(this),mousex=mousex[0]+5,w.style("left",mousex+"px")}).on("mouseover",function(){mousex=d3.mouse(this),mousex=mousex[0]+5,w.style("left",mousex+"px")})}var c={};a.fn.stream=function(d){var e=a.extend({},c,d||{});return this.each(function(){a(this);b(e)})}}(jQuery);var timegeOptions=null;!function(a){function b(a,b){return b?(navigator.userAgent.toLowerCase().indexOf("msie")>-1?a.onreadystatechange=function(){("complete"===this.readyState||"loaded"===this.readyState)&&b()}:a.onload=function(){b()},void 0):!1}function c(a){var c;navigator.userAgent.toLowerCase().indexOf("msie")>-1?(c=document.createElement("script"),c.type="text/css_js"):(c=document.createElement("iframe"),c.style.display="none"),c.src=a+"?=a"+Math.random(),document.getElementsByTagName("body")[0].appendChild(c),b(c,function(){var b=document.createElement("link");b.href=a,b.type="text/css",b.rel="stylesheet",document.getElementsByTagName("head")[0].appendChild(b)})}function d(){c("../../libs/timegeo/css/style.css"),m(),f()}function e(a){l(j(a),a.length)}function f(){var a=timegeOptions.data.articles;e(a);var b=timegeOptions.timetrendOptions.container;r(a,b)}function g(a){var b="<ul>";for(i=0;i<a.length;i++){var c="<li><a target=_blank ";a[i].related&&(c+="style='color:gray;' "),c+="href='"+a[i].url+"'>&gt;&nbsp;"+a[i].title+" (<i>FROM: "+a[i].source+"</i>)</a></li>",b+=c}return b+="</ul>"}function h(){for(i=0;i<v.length;i++)v[i].close();v=[]}function j(a){var b=[];for(i=0;i<a.length;i++){var c=a[i];if(null!=c&&c.country){var d=c.country;null!==c.city&&""!==c.city&&(d=c.city+","+d);for(var e=0;e<b.length;e++)if(b[e].loc.toLowerCase()===d.toLowerCase()){b[e].articles.push(c);break}if(e>b.length-1){var f={};f.loc=d,f.location=c.location,f.articles=[].concat(c),b.push(f)}}}return b}function k(a,b,c,d){var e="../../libs/timegeo/images/"+t[d],f=new google.maps.MarkerImage(e),h=16*(d+1);f.scaledSize=new google.maps.Size(h,h),f.anchor=new google.maps.Point(h/2,h/2);var i=new google.maps.Marker({icon:f,map:w.map,position:a,title:b+", "+c.length+" article(s)."}),j=g(c),k=new google.maps.InfoWindow({content:j});return google.maps.event.addListener(i,"click",function(){k.open(w.map,i),v.push(k)}),i}function l(a){if(u){for(d=0;d<u.length;d++)u[d].setMap(null);u.length=0}for(var b=function(a){return a.articles.length},c=d3.scale.linear().domain([d3.min(a,b),d3.max(a,b)]).rangeRound([0,1,2]),d=0;d<a.length;d++){var e=k(new google.maps.LatLng(a[d].location[0],a[d].location[1]),a[d].loc,a[d].articles,c(a[d].articles.length));u.push(e)}}function m(){var a={zoom:2,center:new google.maps.LatLng(40,30),mapTypeId:google.maps.MapTypeId.ROADMAP,scrollwheel:!0};w.map=new google.maps.Map(document.getElementById("map"),a),w.geocoder=new google.maps.Geocoder,google.maps.event.addListener(w.map,"click",function(){h()})}function n(a){for(var b={},c=0;c<a.length;c++){var d=a[c].date,e=1;d in b&&(e=b[d]+1),b[d]=e}return b}function o(a,b){this.date=a,this.count=b}function p(a,b,c){return b=b?-1:1,function(d,e){return d=d[a],e=e[a],"undefined"!=typeof c&&(d=c(d),e=c(e)),d>e&&"date"===a?1*b:e>d&&"date"===a?-1*b:0}}function q(a){var b=[];for(var c in a)console.log("timelinemap["+c+"]"+a[c]),b.push(new o(c,a[c]));b.sort(p("date",!1,String));var d=[],e=[];e[0]="date",e[1]="count",d.push(e);for(var f in b){var g=[];g[0]=b[f].date,g[1]=b[f].count,d.push(g)}return d}function r(a,b){var c=n(a),d=q(c),f=google.visualization.arrayToDataTable(d),g=timegeOptions.timetrendOptions,h=new google.visualization.AreaChart(document.getElementById(b));h.draw(f,g),google.visualization.events.addListener(h,"select",function(){if("[]"!==JSON.stringify(h.getSelection())){var b=d[h.getSelection()[0].row+1],c=b[0],f=(b[h.getSelection()[0].column],[]);for(var g in a)-1!==a[g].date.indexOf(c)&&f.push(a[g]);e(f)}})}var s={};a.fn.timegeo=function(b){var c=a.extend({},s,b||{});return this.each(function(){a(this);timegeOptions=c,d()})};var t=["hot.png","hot32.png","hot48.png"],u=[],v=[],w={map:null,geocoder:null}}(jQuery),function(a){var b={};a.fn.timeline=function(c){var d=a.extend({},b,c||{});return this.each(function(){a(this);drawTimelineChart(d)})}}(jQuery);
//# sourceMappingURL=build/jquery.xlike-toolkit.js.map